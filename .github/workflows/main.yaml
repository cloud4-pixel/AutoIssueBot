name: AutoIssueBot
on: push

jobs:
  
  get-file:
    runs-on: ubuntu-latest
    outputs:
      file-name: ${{ steps.get-app-file.outputs.file }}
      file-content: ${{ steps.read-app-content.outputs.content }}

    steps:

      - name: Get Code
        uses: actions/checkout@v3


      - name: Get code
        id: get-app-file
        run: |
          file=$(find . -type f -name 'app.*' | head -n 1)
          echo "file=$file" >> "$GITHUB_OUTPUT"      
      
      - name: Read file content
        id: read-app-content
        run: |
          content=$(cat ${{ steps.get-app-file.outputs.file }} | base64 -w 0)
          echo "content=$content" >> $GITHUB_OUTPUT

  send_to_gemini:
    runs-on: ubuntu-latest

    env: 
      GOOGLE_API_KEY : ${{ secrets.GOOGLE_API_KEY }}
    environment: send_to_gemini
    needs: get-file

    steps:
      - name: send to gemini
        run: |
            decoded=$(echo "$FILE_CONTENT" | base64 --decode)
            curl -s -X POST \
              "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GOOGLE_API_KEY}" \
              -H "Content-Type: application/json" \
              -d '{
                "contents": [
                  {
                    "parts": [
                      { "text": "שלום ג׳מיני, $decoded" }
                    ]
                  }
                ]
              }'

              echo: hello
